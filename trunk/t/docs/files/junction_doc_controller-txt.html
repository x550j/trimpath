<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>web-MVC Controller</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script></head><body class=UnframedPage onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.35 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<table border=0 cellspacing=0 cellpadding=0 width=100%><tr><td class=MenuSection valign=top><!--START_ND_MENU--><div class=MEntry><div class=MFile><a href="junction_doc_about-txt.html">About TrimPath Junction</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_run-txt.html">Runtime Environments</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_run_browser-txt.html">Runtime In The Browser</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_run_server-txt.html">Runtime On The Server</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_sync-txt.html">Synchronization</a></div></div><div class=MEntry><div class=MFile><a href="junction-js.html">TrimPath.<span class=HB> </span>junction</a></div></div><div class=MEntry><div class=MFile><a href="junctionClient-js.html">TrimPath.<span class=HB> </span>junctionClient</a></div></div><div class=MEntry><div class=MFile><a href="junctionUtil-js.html">TrimPath.<span class=HB> </span>junctionUtil</a></div></div><div class=MEntry><div class=MFile id=MSelected>web-MVC Controller</div></div><div class=MEntry><div class=MFile><a href="junction_doc_model-txt.html">web-MVC Model</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_view-txt.html">web-MVC View</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Index</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MIndex><a href="../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Classes.html">Classes</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Variables.html">Variables</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Properties.html">Properties</a></div></div></div></div></div><!--END_ND_MENU--></td>

<td class=ContentSection valign=top><div class=CGeneric id=MainTopic><div class=CTopic><h1 class=CTitle><a name="web-MVC_Controller"></a>web-MVC Controller</h1><div class=CBody><p class=CParagraph>The Controller in the web Model-View-Controller (web-MVC) design is responsible for answering to web requests.&nbsp;  It orchestrates a response by calling on the Model objects and rendering a View template.</p><p class=CParagraph>A Controller is just a JavaScript function (sometimes called constructor), whose methods are also known as <b>actions</b>.&nbsp;  Each controller is contained in its own separate file, under the /app/controllers/[controllerName]Controller.js naming pattern.&nbsp;  For example, /app/controllers/blogController.js might contain...</p><blockquote><pre class=CCode>BlogController = function() {}<br><br>BlogController.prototype.time = function(req, res) {<br>  res.renderText('The current time is ' + new Date());<br>}<br><br>BlogController.prototype.listPosts = function(req, res) {<br>  res.posts = Blog.findActive('all');<br>}</pre></blockquote><p class=CParagraph>An incoming HTTP request with request query parameters such as ?controllerName=blog&amp;actionName=listPosts tells the Junction system to invoke the controller named &lsquo;blog&rsquo; and the action method named &lsquo;listPosts&rsquo;.&nbsp;  Junction uses naming conventions to find and instantiate a controller function/constructor called &lsquo;BlogController&rsquo;.</p><h4 class=CHeading>Naming Conventions</h4><p class=CParagraph>By convention, a controllerName (used as a URL request parameter) is uncaptialized and singular, such as &lsquo;blog&rsquo; or &lsquo;calender&rsquo; or &lsquo;orderHistory&rsquo;.&nbsp;  For example, the URL request parameters might be ?controllerName=orderHistory&amp;actionName=list</p><p class=CParagraph>The filenames for controllers are the controllerName concatenated with a  &lsquo;Controller.js&rsquo; suffix.&nbsp;  For example, blogController.js, calenderController.js, or orderHistoryController.js.</p><p class=CParagraph>The controller function/constructor name is a capitalized controllerName, singular, with a &lsquo;Controller&rsquo; suffix.&nbsp;  For example, BlogController, CalenderController, or OrderHistoryController.</p><p class=CParagraph>Programmers should use the global variable programming idiom as show above, rather than private variable idiom, so that the Junction system can easily reload code automatically as it&rsquo;s changed.&nbsp;  Otherwise, development will be horribly unproductive.&nbsp;  For example, use the following coding style when defining a controller function/constructor...</p><blockquote><pre class=CCode>OrderHistoryController = function() {} // Correct.</pre></blockquote><p class=CParagraph>instead of...</p><blockquote><pre class=CCode>function OrderHistoryController() {} // Wrong, won't reload automatically.</pre></blockquote><p class=CParagraph>and instead of...</p><blockquote><pre class=CCode>var OrderHistoryController = function() {} // Wrong, won't reload automatically.</pre></blockquote><h4 class=CHeading>Action Methods</h4><p class=CParagraph>The Junction runtime system will create a new instance of the controller for every request.&nbsp;  For example, if the HTTP request parameters are ?controllerName=blog&amp;actionName=listPosts, then Junction will (handwave) call...</p><blockquote><pre class=CCode>var controller = new BlogController();</pre></blockquote><p class=CParagraph>Next, Junction looks for an action method on the controller instance named actionName.&nbsp;  Any actionName prefixed with an underscore (_) character will be considered private and not web-accessible, and will not be invoked by Junction in response to a request.&nbsp;  That is, request parameters that look like ?controllerName=invoice&amp;actionName=_cancellationProcess will not succeed.</p><p class=CParagraph>Junction invokes the controller&rsquo;s action method with two parameters -- a request object and a response object.&nbsp;  (e.g., Junction calls controller[actionName](request, response)).&nbsp;  By convention, these are usually known as <b>req</b> and <b>res</b>.</p><h4 class=CHeading>The req object</h4><p class=CParagraph>The req object is a map object, containing key/value pairs of all the incoming parameters of the request.&nbsp;  GET and POST parameters are both contained in this map.</p><p class=CParagraph>Junction also converts nested parameter names into corresponding nested maps.&nbsp;  Any parameter whose name follows a multi-level &lsquo;key1[key2][keyN]&rsquo; naming pattern triggers this conversion.&nbsp;  For example, parameters that looked like...</p><blockquote><pre class=CCode>?order[total]=24.99&amp;order[customer]=John<br> &amp;order[line0][item]=shoe&amp;order[line0][price]=14.99<br> &amp;order[line1][item]=hat&amp;order[line1][price]=10.00<br> &amp;shipping=3_to_5_days</pre></blockquote><p class=CParagraph>would be converted Junction to the req object as something like...</p><blockquote><pre class=CCode>req = {}<br>req.order = {}<br>req.order.total = '24.99'<br>req.order.customer = 'John'<br>req.order.line0 = {}<br>req.order.line0.item = 'shoe'<br>req.order.line0.price = '14.99'<br>req.order.line1 = {}<br>req.order.line1.item = 'hat'<br>req.order.line1.price = '10.00'<br>req.shipping = '3_to_5_days'</pre></blockquote><p class=CParagraph>Note that all parameters in the hierarchical map are string values, leaving parsing of values to different types as the responsibility of the application.&nbsp;  For example...</p><blockquote><pre class=CCode>var orderTotal = parseInt(req.order.total);</pre></blockquote><h4 class=CHeading>The res object</h4><p class=CParagraph>The res object is a map object.&nbsp;  It also contains methods to help render templates.</p><p class=CParagraph>The controller may also place objects and values into the res object, which the template can later access.&nbsp;  For example...</p><blockquote><pre class=CCode>BlogController = function() {<br>  this.show = function(req, res) {<br>    res.blog = Blog.findActive(req['objId']);<br>  }<br>  ...</pre></blockquote><p class=CParagraph>In the show action, the res[&lsquo;blog&rsquo;] entry is set with the result of a Model query.&nbsp;  Here, the model is a Blog model.</p><p class=CParagraph>Later, the template can reference the blog object...</p><blockquote><pre class=CCode>title: &lt;%= blog.title %&gt;<br>entry: &lt;%= blog.body %&gt;</pre></blockquote><h4 class=CHeading>Private Variables</h4><p class=CParagraph>The Junction runtime will create a new instance of the controller for every request (e.g., Junction will call: new BlogController()).</p><p class=CParagraph>Because of this, if you wanted to have controller private variables, you may your controller function/constructor using a closure-based idiom instead of using the prototype idiom....</p><blockquote><pre class=CCode>BlogController = function() {<br>  var userPassword = null; // A controller-instance private variable.<br><br>  this.create = function(req, res) {<br>    // ... use the private variable here<br>  }<br><br>  this.listArchivedPosts = function(req, res) {<br>    // ... use the private variable here<br>  }<br>}</pre></blockquote></div></div></div>

</td>

</tr></table><div class=Footer><!--START_ND_FOOTER-->Generated by <a href="http://www.naturaldocs.org">Natural Docs</a><!--END_ND_FOOTER--></div>
<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>